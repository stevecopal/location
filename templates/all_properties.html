{% extends 'base.html' %}
{% load static %}
{% load i18n %}

{% block title %}{% trans "All Properties - CopalFinder" %}{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4">
    <!-- Header Section -->
    <div class="text-center mb-10">
        <h1 class="text-3xl font-bold text-primary-blue">{% trans "Discover Our Properties" %}</h1>
        <p class="text-gray-600 mt-2">{% trans "Find your perfect rental home from our curated collection" %}</p>
    </div>

    <!-- Search and Filter Section -->
            <div class="max-w-5xl mx-auto bg-white rounded-lg shadow-md p-6 mb-8">
                <form id="search-form" method="get" action="{% url 'all_properties' %}" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                    <!-- Location -->
                    <div>
                        <label for="location" class="block text-sm font-medium text-primary-blue mb-1">{% trans "Location" %}</label>
                        <input
                            type="text"
                            id="location"
                            name="location"
                            value="{{ location }}"
                            placeholder="{% trans 'Enter location' %}"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-blue focus:border-transparent transition duration-200"
                            aria-label="{% trans 'Search by location' %}"
                        >
                    </div>

                    <!-- Property Type -->
                    <div>
                        <label for="property_type" class="block text-sm font-medium text-primary-blue mb-1">{% trans "Property Type" %}</label>
                        <select
                            id="property_type"
                            name="property_type"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-blue focus:border-transparent transition duration-200"
                            aria-label="{% trans 'Select property type' %}"
                        >
                            <option value="" {% if not property_type %}selected{% endif %}>{% trans "All Types" %}</option>
                            {% for category in categories %}
                                <option value="{{ category.name|lower }}" {% if property_type == category.name|lower %}selected{% endif %}>
                                    {{ category.name }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- Price Range -->
                    <div>
                        <label for="price_range" class="block text-sm font-medium text-primary-blue mb-1">{% trans "Price Range" %}</label>
                        <select
                            id="price_range"
                            name="price_range"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-blue focus:border-transparent transition duration-200"
                            aria-label="{% trans 'Select price range' %}"
                        >
                            <option value="" {% if not price_range %}selected{% endif %}>{% trans "Any Price" %}</option>
                            <option value="under_100k" {% if price_range == 'under_100k' %}selected{% endif %}>{% trans "Under FCFA 100,000" %}</option>
                            <option value="100k_200k" {% if price_range == '100k_200k' %}selected{% endif %}>{% trans "FCFA 100,000 - 200,000" %}</option>
                            <option value="200k_500k" {% if price_range == '200k_500k' %}selected{% endif %}>{% trans "FCFA 200,000 - 500,000" %}</option>
                            <option value="over_500k" {% if price_range == 'over_500k' %}selected{% endif %}>{% trans "Over FCFA 500,000" %}</option>
                        </select>
                    </div>

                    <!-- Search Button -->
                    <div class="flex items-end">
                        <button
                            type="submit"
                            class="bg-accent-orange hover:bg-accent-light text-white font-medium py-2 px-4 rounded-full transition-colors"
                            aria-label="{% trans 'Search properties' %}"
                        >
                            {% trans "Search" %}
                        </button>
                    </div>
                </form>
            </div>

            <!-- Error Message -->
            <div id="search-error" class="col-span-1 md:col-span-4 hidden text-red-600 text-sm mt-2" role="alert">
                <i class="fas fa-exclamation-circle mr-1"></i>
                {% trans "Please enter at least one search criterion." %}
            </div>
        </form>
    </div>

    <style>
        .transition-all { transition: all 0.3s ease-in-out; }
        input, select { background-color: #f9fafb; }
        input:focus, select:focus { border-color: #1e4a76; box-shadow: 0 0 0 3px rgba(30, 74, 118, 0.1); }
    </style>

    <script>
        document.getElementById('search-form').addEventListener('submit', function(event) {
            const location = document.getElementById('location').value.trim();
            const propertyType = document.getElementById('property_type').value;
            const priceRange = document.getElementById('price_range').value;
            const errorDiv = document.getElementById('search-error');
            if (!location && !propertyType && !priceRange) {
                event.preventDefault();
                errorDiv.classList.remove('hidden');
            } else {
                errorDiv.classList.add('hidden');
            }
        });
    </script>

    <!-- Properties Grid -->
    {% if properties %}
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
        {% for property in properties %}
        <div class="bg-white rounded-lg shadow-sm overflow-hidden hover:shadow-md transition-shadow duration-300">
            <div class="relative">
                {% if property.photos.first %}
                    <img src="{{ property.photos.first.image.url }}" class="w-full h-48 object-cover" alt="{{ property.category.name }}">
                {% else %}
                    <div class="w-full h-48 bg-gray-200 flex items-center justify-center">
                        <i class="fas fa-home text-4xl text-gray-400"></i>
                    </div>
                {% endif %}
                <div class="absolute top-3 left-3">
                    <span class="bg-accent-orange text-white text-xs px-2 py-1 rounded-full">
                        {{ property.category.name }}
                    </span>
                </div>
                <div class="absolute top-3 right-3">
                    <button class="bg-white p-2 rounded-full shadow-sm hover:bg-accent-orange hover:text-white transition-colors">
                        <i class="fas fa-heart"></i>
                    </button>
                </div>
            </div>

            <div class="p-4">
                <p class="text-gray-600 text-sm mb-3">{{ property.description|truncatewords:15 }}</p>
                <div class="flex items-center justify-between mb-3">
                    <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">
                        {% if property.is_available %}{% trans "Available" %}{% else %}{% trans "Occupied" %}{% endif %}
                    </span>
                </div>
                <div class="flex items-center justify-between border-t border-gray-100 pt-3">
                    <span class="text-xl font-bold text-accent-orange">Fcfa{{ property.price_per_month }}</span>
                    <span class="text-sm text-gray-600">{% trans "/month" %}</span>
                </div>
                <a href="{% url 'property_detail' property.id %}" class="block w-full bg-primary-blue hover:bg-primary-light text-white text-center py-2 px-4 rounded-lg mt-4 transition-colors">
                    {% trans "View Details" %}
                </a>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="text-center py-16 bg-white rounded-lg shadow-sm">
        <i class="fas fa-search text-4xl text-gray-300 mb-4"></i>
        <h3 class="text-xl font-semibold text-gray-600 mb-2">{% trans "No properties found" %}</h3>
        <p class="text-gray-500">{% trans "Try adjusting your search criteria or check back later for new listings." %}</p>
    </div>
    {% endif %}

    <!-- Pagination -->
    {% if properties.has_other_pages %}
    <div class="flex justify-center mt-8">
        <nav class="flex items-center space-x-2">
            {% if properties.has_previous %}
                <a href="?page={{ properties.previous_page_number }}" class="px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                    <i class="fas fa-chevron-left"></i>
                </a>
            {% endif %}
            {% for num in properties.paginator.page_range %}
                {% if properties.number == num %}
                    <span class="px-3 py-2 bg-accent-orange text-white rounded-lg">{{ num }}</span>
                {% else %}
                    <a href="?page={{ num }}" class="px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">{{ num }}</a>
                {% endif %}
            {% endfor %}
            {% if properties.has_next %}
                <a href="?page={{ properties.next_page_number }}" class="px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                    <i class="fas fa-chevron-right"></i>
                </a>
            {% endif %}
        </nav>
    </div>
    {% endif %}
</div>

<style>
    .transition-colors { transition: color 0.2s, background-color 0.2s, border-color 0.2s; }
    .transition-shadow { transition: box-shadow 0.3s; }
</style>
{% endblock %}
