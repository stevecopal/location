{% extends 'base.html' %}
{% load static %}

{% block title %}{{ action }} Review -  CopalFinder{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto px-4 py-6">
    <!-- Header -->
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-primary-blue mb-2">{{ action }} Review</h1>
        <p class="text-gray-600">Share your experience for {{ property.category.name }} in {{ property.location }}</p>
    </div>

    <!-- Property Preview -->
    <div class="bg-white rounded-xl shadow-sm p-6 mb-8">
        <div class="flex items-center">
            {% if property.photos.first %}
            <img src="{{ property.photos.first.image.url }}" class="w-16 h-16 object-cover rounded-lg mr-4" alt="{{ property.category.name }}">
            {% else %}
            <div class="w-16 h-16 bg-gray-200 rounded-lg flex items-center justify-center mr-4">
                <i class="fas fa-home text-gray-400"></i>
            </div>
            {% endif %}
            <div>
                <h3 class="font-semibold text-primary-blue">{{ property.category.name }}</h3>
                <p class="text-gray-600 text-sm">
                    <i class="fas fa-map-marker-alt text-accent-orange mr-1"></i>
                    {{ property.location }}
                </p>
            </div>
        </div>
    </div>

    <!-- Review Form -->
    <div class="bg-white rounded-xl shadow-sm p-6">
        <form method="post" class="space-y-6">
            {% csrf_token %}
            
            <!-- Rating Field -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    Rating <span class="text-red-500">*</span>
                </label>
                <div class="flex space-x-1 mb-2" id="rating-stars">
                    {% for i in "12345" %}
                    <button type="button" class="text-2xl text-gray-300 hover:text-accent-orange transition-colors" data-rating="{{ forloop.counter }}">
                        <i class="fas fa-star"></i>
                    </button>
                    {% endfor %}
                </div>
                <input type="hidden" name="rating" id="id_rating" value="{{ form.rating.value|default:'5' }}">
                {% if form.rating.errors %}
                <p class="text-red-500 text-sm mt-1">{{ form.rating.errors.0 }}</p>
                {% endif %}
            </div>

            <!-- Message Field -->
            <div>
                <label for="{{ form.message.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                    Your Review <span class="text-red-500">*</span>
                </label>
                <textarea 
                    name="{{ form.message.name }}" 
                    id="{{ form.message.id_for_label }}" 
                    rows="5"
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-accent-orange focus:border-transparent"
                    placeholder="Share your experience with this property..."
                >{{ form.message.value|default:'' }}</textarea>
                {% if form.message.errors %}
                <p class="text-red-500 text-sm mt-1">{{ form.message.errors.0 }}</p>
                {% endif %}
            </div>

            <!-- Form Actions -->
            <div class="flex flex-col sm:flex-row gap-4 pt-4">
                <button type="submit" class="bg-accent-orange hover:bg-accent-light text-white px-6 py-3 rounded-lg font-semibold transition-colors flex-1">
                    {% if action == 'Create' %}Submit Review{% else %}Update Review{% endif %}
                </button>
                <a href="{% url 'review_list' %}" class="border border-gray-300 text-gray-700 hover:bg-gray-50 px-6 py-3 rounded-lg font-semibold text-center transition-colors flex-1">
                    Cancel
                </a>
            </div>
        </form>
    </div>

    <!-- Review Guidelines -->
    <div class="bg-blue-50 rounded-xl p-6 mt-8">
        <h3 class="text-lg font-semibold text-primary-blue mb-3">Review Guidelines</h3>
        <ul class="space-y-2 text-sm text-gray-600">
            <li class="flex items-start">
                <i class="fas fa-check-circle text-green-500 mt-1 mr-2"></i>
                <span>Be honest and specific about your experience</span>
            </li>
            <li class="flex items-start">
                <i class="fas fa-check-circle text-green-500 mt-1 mr-2"></i>
                <span>Focus on the property features and amenities</span>
            </li>
            <li class="flex items-start">
                <i class="fas fa-check-circle text-green-500 mt-1 mr-2"></i>
                <span>Mention the location and neighborhood</span>
            </li>
            <li class="flex items-start">
                <i class="fas fa-check-circle text-green-500 mt-1 mr-2"></i>
                <span>Keep it respectful and constructive</span>
            </li>
        </ul>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const ratingStars = document.querySelectorAll('#rating-stars button');
        const ratingInput = document.getElementById('id_rating');
        const currentRating = parseInt(ratingInput.value) || 5;

        // Initialize stars with current rating
        updateStars(currentRating);

        ratingStars.forEach(star => {
            star.addEventListener('click', function() {
                const rating = parseInt(this.getAttribute('data-rating'));
                ratingInput.value = rating;
                updateStars(rating);
            });

            star.addEventListener('mouseenter', function() {
                const hoverRating = parseInt(this.getAttribute('data-rating'));
                updateStars(hoverRating, true);
            });

            star.addEventListener('mouseleave', function() {
                updateStars(parseInt(ratingInput.value));
            });
        });

        function updateStars(rating, isHover = false) {
            ratingStars.forEach(star => {
                const starRating = parseInt(star.getAttribute('data-rating'));
                if (starRating <= rating) {
                    star.classList.remove('text-gray-300');
                    star.classList.add('text-accent-orange');
                } else {
                    star.classList.remove('text-accent-orange');
                    star.classList.add('text-gray-300');
                }
                
                if (isHover) {
                    star.classList.add('scale-110');
                } else {
                    star.classList.remove('scale-110');
                }
            });
        }
    });
</script>

<style>
    .transition-colors {
        transition: color 0.2s, background-color 0.2s;
    }
    .scale-110 {
        transform: scale(1.1);
        transition: transform 0.2s;
    }
</style>
{% endblock %}